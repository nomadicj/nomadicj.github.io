<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  

  <title>Using LetsEncrypt Ephemerally</title>
  <meta name="description" content="Delivering encrypted static websites using S3, Cloudfront and LetsEncrypt

">
  <meta name="author" content="James Armstrong">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Using LetsEncrypt Ephemerally">
  <meta name="twitter:description" content="Delivering encrypted static websites using S3, Cloudfront and LetsEncrypt

">
  
  <meta name="twitter:creator" content="nomadicj">
  
  <meta name="twitter:image" content="/images/favicons/favicon-194x194.png" />

  <meta property="og:type" content="article">
  <meta property="og:title" content="Using LetsEncrypt Ephemerally">
  <meta property="og:description" content="Delivering encrypted static websites using S3, Cloudfront and LetsEncrypt

">
  <meta property="og:image" content="/images/favicons/favicon-194x194.png" />

  <link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-194x194.png" sizes="194x194">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/images/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/images/favicons/manifest.json">
  <link rel="shortcut icon" href="/images/favicons/favicon.ico">
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">
  
  <link rel="stylesheet" href="/css/main.css?1669250108292917000">
  <link rel="canonical" href="http://localhost:4000/2019/letsencrypt-container/">
  <link rel="alternate" type="application/rss+xml" title="nomadic blogging" href="/feed.xml">
</head>


  <body>
    <span class="mobile btn-mobile-menu">
  <i class="icon icon-list btn-mobile-menu__icon"></i>
  <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
</span>

<header class="panel-cover" style="background-image: url(/images/cover.jpg)">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <a href="/" title="link to home of nomadic blogging">
          <img src="/images/profile.jpg" class="user-image" alt="My Profile Photo">
          <h1 class="panel-cover__title panel-title">nomadic blogging</h1>
        </a>
        <hr class="panel-cover__divider">
        <p class="panel-cover__description">Nomadic Blog; Just another techie learning, applying and sharing.</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="link to nomadic blogging blog" class="blog-button">Blog</a></li>
            </ul>
          </nav>

          <nav class="cover-navigation navigation--social">
            <ul class="navigation">

            
              <!-- Twitter -->
              <li class="navigation__item">
                <a href="http://twitter.com/nomadicj" title="@nomadicj on Twitter" target="_blank">
                  <i class="icon icon-social-twitter"></i>
                  <span class="label">Twitter</span>
                </a>
              </li>
            

            

            
              <!-- LinkedIn -->
              <li class="navigation__item">
                <a href="https://www.linkedin.com/in/jnarmstrong" title="jnarmstrong on LinkedIn" target="_blank">
                  <i class="icon icon-social-linkedin"></i>
                  <span class="label">LinkedIn</span>
                </a>
              </li>
            

            
              <!-- LinkedIn -->
              <li class="navigation__item">
                <a href="https://stackshare.io/nomadicj/job-stack" title="nomadicj on StackShare" target="_blank">
                  <i class="icon icon-social-stackshare"></i>
                  <span class="label">StackShare</span>
                </a>
              </li>
            

            
              <!-- GitHub -->
              <li class="navigation__item">
                <a href="https://www.github.com/nomadicj" title="nomadicj on GitHub" target="_blank">
                  <i class="icon icon-social-github"></i>
                  <span class="label">GitHub</span>
                </a>
              </li>
            

            
              <!-- Email -->
              <li class="navigation__item">
                <a href="mailto:j@armstro.ca" title="Email j@armstro.ca" target="_blank">
                  <i class="icon icon-mail"></i>
                  <span class="label">Email</span>
                </a>
              </li>
            

            <!-- RSS -->
            <li class="navigation__item">
              <a href="/feed.xml" title="Subscribe" target="_blank">
                <i class="icon icon-rss"></i>
                <span class="label">RSS</span>
              </a>
            </li>

            </ul>
          </nav>

        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>


    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="2019-01-02 21:00" class="post-meta__date date">2 Jan 2019</time>
      
      &#8226; <span class="post-meta__tags">on <a href="/tags/#letsencrypt">letsencrypt</a>, <a href="/tags/#s3">s3</a>, <a href="/tags/#cloudfront">cloudfront</a>, <a href="/tags/#tls">tls</a>, <a href="/tags/#ssl">ssl</a>, <a href="/tags/#https">https</a>, <a href="/tags/#route53">route53</a>, <a href="/tags/#certbot">certbot</a>, <a href="/tags/#circleci">circleci</a>, <a href="/tags/#docker">docker</a>, <a href="/tags/#containers">containers</a></span>
      
    </div>
    <h1 class="post-title">Using LetsEncrypt Ephemerally</h1>
  </header>

  <section class="post">
    <h2 id="delivering-encrypted-static-websites-using-s3-cloudfront-and-letsencrypt">Delivering encrypted static websites using S3, Cloudfront and LetsEncrypt</h2>

<p>LetsEncrypt is a great project launched in 2016 by, among others, Mozilla and the Electronic Frontier Foundation, to make TLS certs and therefore https encryption an accessible standard for all of us. Most of the documentation out there demonstrates how to use CertBot to create and maintain certs on static webservers, but with modern single page apps and other static content that no longer needs Apache, Nginx and their like, why pay to run a server when you can deliver the same content for pennies? I built this blog using just these technologies, but the LetsEncrypt was a touch more in depth than I initially suspected it would be. Lets dig into that.</p>

<h3 id="letsencrypt-acme-and-certbot">LetsEncrypt, ACME and Certbot</h3>

<p>The LetsEncrypt service presents a Restful API which clients can use a challenge-response protocol call Automated Certificate Management Environment (ACME) to obtain and renew certificates. As part of that, number of of state files are created that are subsequently used to renew certificates. Great, but how can I use that when I’m not maintaining a server upon which that would reside? We should probably maintain that somewhere.</p>

<h3 id="s3-the-filestore-for-the-serverless">S3; the filestore for the serverless</h3>

<p>Using S3 as a filestore is a great way of persisting files without maintaining an actual file system. Seeing as we don’t have a persistent file system handy in our ephemeral state, that’s handy. In order to persist that state, we’ll need to write a little code (in this case shell), to pull and push the state as required.</p>

<h3 id="letsencrypt-verification">LetsEncrypt Verification</h3>

<p>Allowing anyone to create certs for any domain would probably be a bad thing. Therefore LetsEncrypt forces you to do some proof of ownership work. In this case, we will be using the AWS Route53 plugin to use the actual DNS entry for the URL in question to prove ownership. We’ll also need to create an IAM profile and role to allow a user to securely to that.</p>

<h3 id="s3---cloudfront">S3 -&gt; CloudFront</h3>

<p>Hosting static content in S3 using the ‘website’ function it offers sounds great, but S3 doesn’t actually allow you to use your own SSL certs to create an HTTPS endpoint. Fortunately, CloudFront (the AWS CDN), does. Once we have configured that, we just need to get it to use the new cert.</p>

<p>So to recap,
LetsEncrypt Cert -&gt; CloudFront &lt;- S3 &lt;- Static Content
Cert state -&gt; S3</p>

<p>Just to host a static website? I thought this was supposed to be easy?</p>

  </section>
  
</article>



      </div>

      <footer class="footer">
  <span class="footer__copyright">&copy; 2022 James Armstrong. All rights reserved.</span>
</footer>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js?1669250108292917000"></script>


    </div>
  </body>
</html>